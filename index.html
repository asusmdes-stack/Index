<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Оплата 10 Stars</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body style="display:flex;justify-content:center;align-items:center;height:100vh;background:#fff;">
  <button id="payBtn" style="padding:12px 24px;font-size:18px;">Оплатить 10 Stars</button>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    document.getElementById("payBtn").addEventListener("click", async () => {
      const user_id = tg.initDataUnsafe?.user?.id;
      const initData = tg.initData; // <-- вот это важно

      if (!user_id) {
        tg.showAlert("Ошибка: Telegram не передал user_id");
        return;
      }

      try {
        const res = await fetch("/api/invoice", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ user_id, init_data: initData }),
        });

        const data = await res.json();
        if (data.status === "ok") {
          tg.showAlert("Инвойс создан прямо в Mini App!");
        } else {
          tg.showAlert("Ошибка: " + (data.error || "не удалось создать инвойс"));
        }
      } catch (err) {
        tg.showAlert("Ошибка соединения: " + err.message);
      }
    });
  </script>
</body>
</html>
